<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Registration</title>
    <style>
        .error-message {
            color: red;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- 회원가입 폼 -->
    <form action="/users/join" method="post" th:object="${userDto}" onsubmit="return validateForm()">
        <h2>회원가입</h2>
    <!-- 아이디 입력 -->
    <label for="userId">아이디:</label>
    <input type="text" id="userId" name="userId" required pattern="^[A-Za-z0-9]{4,10}$">
    <span id="valid_userId"></span><br>

        <!-- 중복 확인 버튼 -->
        <button type="button" onclick="checkDuplicate()">중복 확인</button>
        <div id="duplicateMessage" class="error-message"></div><br>

    <!-- 비밀번호 입력 -->
    <label for="pwd">비밀번호:</label>
    <input type="password" id="pwd" name="pwd" required pattern="(?=.*[0-9])(?=.*[a-zA-Z])(?=.*\W)(?=\S+$).{8,16}">
    <span id="valid_pwd"></span><br>

    <!-- 이름 입력 -->
    <label for="name">이름:</label>
    <input type="text" id="name" name="name" required pattern="^[가-힣_]{1,100}$">
    <span id="valid_name"></span><br>

    <!-- 이메일 입력 -->
    <label for="email">이메일:</label>
    <input type="email" id="email" name="email" required>
    <span id="valid_email"></span><br>

    <!-- 휴대전화번호 입력 -->
    <label for="phone">휴대전화번호:</label>
    <input type="tel" id="phone" name="phone" pattern="^01\d{8,9}$">
    <span id="valid_phone"></span><br>

        <button type="submit">가입하기</button>
</form>
</div>

<!-- 중복 확인을 위한 JavaScript 코드 -->

<script th:inline="javascript">
    function checkDuplicate() {
        var userId = document.getElementById("userId").value;

        // AJAX를 이용해 서버로 아이디 중복 확인 요청
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/users/check-id', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var result = JSON.parse(xhr.responseText);

                // 결과에 따라 메시지 출력
                var duplicateResult = document.getElementById("duplicateResult");
                if (result.duplicate) {
                    duplicateResult.textContent = '사용할 수 없는 아이디입니다.';
                } else {
                    duplicateResult.textContent = '사용 가능한 아이디입니다.';
                }
            }
        };
        xhr.send('userId=' + userId);
    }
    <!-- 유효성 검사 에러 메시지 표시 -->
    function validateForm() {
        var form = document.getElementById("signupForm");
        var isValid = form.checkValidity();

        if (!isValid) {
            // 서버에서 받은 유효성 검사 에러 메시지를 출력
            document.getElementById("valid_userId").textContent = form.valid_userId.value;
            document.getElementById("valid_pwd").textContent = form.valid_pwd.value;
            document.getElementById("valid_name").textContent = form.valid_name.value;
            document.getElementById("valid_email").textContent = form.valid_email.value;
            document.getElementById("valid_phone").textContent = form.valid_phone.value;
        }
        return isValid;
    }
</script>
</body>
</html>
